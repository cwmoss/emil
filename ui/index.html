<!doctype html>
<html>
<head>
  <title>emil admin</title>
  <link rel="shortcut icon" type="image/x-icon" href="ui/favicon.png">
  <link rel='stylesheet' href='ui/nprogress.css'/>
  <link rel='stylesheet' href='ui/app.css'/>

<style>
  [v-cloak] {
    display: none;
  }
</style>

<script type="text/javascript">
    window.__INIT_DATA__ = '';
</script>

<style>


</style>
</head>
<body>

  <div id="admin-app">

     <h1>emil</h1>

     <div v-if="login" class="content">
       <div id="orgs">
        <ul>
          <li v-for="item in orgs"><a v-on:click="select_org(item)" href="javascript:;" v-bind:class="{active:(org && org.name==item)}"  v-html="item"></a>
        </ul>
       </div>

       <div id="org">
        {{org}}
       </div>
    </div>

    <div v-else class="login">
      <form>
        <div class="felement">
          <label for="username">Username</label><br>
          <div class="inp">
            <input type="text" id="username">
          </div>
        </div>
        <div class="felement">
          <label>Password</label><br>
          <div class="inp">
            <input type="text" id="Password">
          </div>
        </div>
        <div class="felement btn">
          <div class="inp">
            <button type="button">Login</button>
          </div>
        </div>
      </form>
    </div>

  </div>


</div>


<script src="ui/vue.js"></script>
<script src="ui/nprogress.js"></script>

<script>

NProgress.configure({ parent: 'body' }); 

const edapp = new Vue({
  components: {
           //    draggable: vuedraggable
          //     markdown_editor: VueEasyMDE
           },
  el: '#admin-app',
  data: function(){
    return {
      ed_content: null,
      active: null,
      base: 'blog/',
      story: null,
      
      login: false,

      orgs: [],
      org: null,

      index: [], 
      cstory:{slug:'', title:''},
      estory:{}
    };
  },
  methods: {
    select_org: function (item) {
      console.log(item);
      NProgress.start()
      this.active = item;
      // this.org = item;
      this.fetch("/admin/org/"+item).then(data => {
        this.org = data
      })

    },
   
    save_content: function(){
      var that = this;
      $axios.post('/story-save-content', {id: that.story.id, content: that.story.o_content})
        .then(resp => {
          if(resp.data) that.story = resp.data;
        });
    },
    fetch: async function(url, opts){
      NProgress.start()
       var res = await fetch(url, opts||{}).finally(function(){
        NProgress.done()
       })

       if(res.status==401){
          this.login = true
          return {err: 'auth'}
       }
       if(!res.ok){
          console.error("err...", res);
          return {err: 'fail'}
          // return Promise.reject(res);
       }
       

       console.log("++ resp", res)
       return await res.json()
    }
  },
  mounted: function(){
    console.log("mounting");
    var vm = this;
    vm.index = window.__INIT_DATA__;
    this.fetch('/admin/orgs').then(data => {
      console.log("data...", data)
      this.orgs = data.orgs
    })
    
      
    
    /*
    this.$modal.beforeOpen = function(e){
      console.log(e);
    };
*/
    /*
    $axios.get('/all')
      .then(function (response) {
      // handle success
      console.log(response.data);
      vm.index = response.data;
    });
    */
  }
});

// }, 50000);

</script>
</body>
</html>
